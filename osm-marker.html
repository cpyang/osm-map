<link rel="import" href="../polymer/polymer.html">
<script src="http://openlayers.org/en/v3.11.2/build/ol.js"></script>

<!--
The `osm-marker` element draws a marker at the given position
with a specified image. (Marker without image attribute are displayed as circles)

Example:

  <osm-map latitude="53.834089" longitude="10.703718" zoom="16">
      <osm-marker longitude="10.703718" latitude="53.834089" scale="0.2" image="../data/marker-blue-shadow.png"></osm-marker>
      <osm-marker longitude="10.705318" latitude="53.835789" image="../data/marker-green-icon-shadow.png"></osm-marker>
      <osm-marker longitude="10.702318" latitude="53.832789" image="../data/marker-red.png"></osm-marker>
      <osm-marker longitude="10.705318" latitude="53.830789"></osm-marker>
      <osm-marker longitude="10.709318" latitude="53.839789" scale="2.5"></osm-marker>
  </osm-map>

@demo demo/index.html
-->

<dom-module id="osm-marker">
  <script>
    Polymer({
      is: 'osm-marker',

      properties: {

        latitude: {
          type: Number,
          notify: true,
          value: 53.834089
        },

        longitude: {
          type: Number,
          notify: true,
          value: 10.703718
        },

        scale: {
          type: Number,
          notify: true,
          value: 0.4
        },

        image: {
          type: String,
          notify: true
        }

      },
      getOsmMarker: function() {
        var iconFeatures = [];

        var iconFeature = new ol.Feature({
          geometry: new ol.geom.Point(ol.proj.fromLonLat([this.longitude, this.latitude])),
          name: 'Ratzeburger Allee 160',
          population: 4000,
          rainfall: 500
        });

        iconFeatures.push(iconFeature);

        var vectorSource = new ol.source.Vector({
          features: iconFeatures //add an array of features
        });

        if(this.image)
          var iconImage = new ol.style.Icon(({
            anchor: [0.5, 46],
            anchorXUnits: 'fraction',
            anchorYUnits: 'pixels',
            opacity: 0.75,
            src: this.image,
            scale: this.scale
          }))
        else
          var iconImage = new ol.style.Circle({
            radius: 25*this.scale,
            fill: new ol.style.Fill({color: 'rgba(255, 0, 0, 0.1)'}),
            stroke: new ol.style.Stroke({color: 'red', width: 1})
          });

        var iconStyle = new ol.style.Style({
          image: iconImage
        });

        return vectorLayer = new ol.layer.Vector({
          source: vectorSource,
          style: iconStyle
        });
      }
    });
  </script>
</dom-module>
